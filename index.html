<!DOCTYPE html>

<!--/* ================= Expense Tracker working code ================= */ -->

<html lang="en">
<head>
<meta charset="UTF-8">
<title>Expense Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ================= THEME ================= */
:root{
  --bg1:#b4d4d2;
  --bg2:#a2c7c5;
  --card:#8fb8b6;
  --text:#0f2a2a;
  --nav:#8fb8b6;
  --icon:#002f2f;
  --icon-active:#001818;
  --header:#a9cfcd;
  --shadow-soft:0 14px 30px rgba(0,0,0,.28);
  --shadow-emboss:inset 3px 3px 6px rgba(0,0,0,.18), inset -3px -3px 6px rgba(255,255,255,.45);
  --btn-edit:#1f8f45;
  --btn-delete:#b02a37;
}

body.dark{
  --bg1:#121214;
  --bg2:#1c1c1e;
  --card:#262628;
  --text:#f5f5f5;
  --nav:#262628;
  --icon:#00dede;
  --icon-active:#00ffff;
  --header:#2f2f31;
  --shadow-soft:0 18px 40px rgba(0,0,0,.7);
  --shadow-emboss:inset 3px 3px 8px rgba(0,0,0,.7), inset -3px -3px 8px rgba(255,255,255,.08);
  --btn-edit:#28a745;
  --btn-delete:#dc3545;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text);
  transition:.35s;
}

.app{
  max-width:420px;
  margin:auto;
  min-height:100vh;
  padding-bottom:160px;
}

.screen{display:none;padding:18px}
.screen.active{display:block}

/* ================= CARD ================= */
.card{
  background:var(--card);
  border-radius:28px;
  padding:22px;
  margin-bottom:18px;
  box-shadow:var(--shadow-soft);
}

/* ================= HOME ================= */
.home-title{text-align:center;font-size:28px;font-weight:800}
.home-quote{text-align:center;margin-top:6px;opacity:.85}
.home-icons{margin-top:20px;font-size:14px;line-height:1.8}
.home-icons div{display:flex;align-items:center;gap:12px}
.home-icons svg{width:18px;height:18px;stroke:var(--icon);stroke-width:2.2}
.home-disclaimer{margin-top:22px;font-size:10px;opacity:.35;text-align:center}

/* ================= FORM ================= */
label{font-size:13px;font-weight:600;margin-top:14px;display:block}
input,select{
  width:100%;
  padding:14px;
  border:none;
  border-radius:18px;
  background:var(--header);
  margin-top:6px;
  color:var(--text);
}

/* ================= BUTTON ================= */
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:999px;
  margin-top:18px;
  background:var(--card);
  font-weight:600;
  box-shadow:var(--shadow-emboss);
  transition:.25s;
  color:var(--text);
}
body.dark button{color:#f5f5f5}
button:hover{transform:translateY(-2px)}

/* ================= TABLE ================= */
.total-caption{text-align:center;font-size:14px;opacity:.8}
.total-box{text-align:center;font-size:22px;font-weight:700;margin-bottom:14px}

table{width:100%;border-spacing:0 12px;border-collapse:separate}
thead th{background:rgba(255,255,255,.2);padding:12px;border-radius:14px}
tbody tr{background:var(--card);border-radius:18px;box-shadow:var(--shadow-soft)}
tbody td{text-align:center;padding:12px}

/* ================= FILTER DROPDOWN ================= */
#categoryFilter{border-radius:999px;padding:12px 16px;background:var(--header);color:var(--text);border:none;margin-bottom:16px;cursor:pointer}

/* ================= ACTION BUTTONS ================= */
.action-btn{padding:6px 16px;border-radius:999px;font-size:12px;font-weight:600;border:none;box-shadow:var(--shadow-emboss);color:#fff}
.edit-btn{background:var(--btn-edit)}
.delete-btn{background:var(--btn-delete)}

/* ================= USER DASHBOARD ================= */
.dashboard{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.stat{padding:16px;border-radius:999px;background:var(--card);text-align:center;font-weight:600;cursor:pointer;box-shadow:var(--shadow-emboss)}
.stat:hover{transform:translateY(-2px)}
.user-output{margin-top:16px;padding:14px;border-radius:18px;background:rgba(0,0,0,.12);font-size:14px}

/* ================= NAV BAR ================= */
.bottom-nav{
  position:fixed;
  bottom:18px;
  left:50%;
  transform:translateX(-50%);
  width:92%;
  max-width:380px;
  height:74px;
  background:var(--nav);
  border-radius:999px;
  display:flex;
  justify-content:space-around;
  align-items:center;
  box-shadow:0 28px 60px rgba(0,0,0,.6);
}
.nav-item{width:48px;height:48px;display:flex;align-items:center;justify-content:center;position:relative;transition:transform .5s cubic-bezier(.22,.61,.36,1)}
.nav-item svg{width:18px;height:18px;stroke:var(--icon);stroke-width:2.2;transition:.35s}
.nav-item::before{content:"";position:absolute;width:52px;height:52px;border-radius:50%;background:#7aa9a7;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);transition:.5s;z-index:-1}
.nav-item.active{transform:translateY(-22px)}
.nav-item.active::before{transform:translate(-50%,-50%) scale(1)}
.nav-item.active svg{stroke:var(--icon-active);transform:scale(1.15)}
</style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="app">
  <div class="screen active">
    <div class="card" style="margin-top:40%;text-align:center">
      <h2>Expense Tracker</h2>
      <p style="opacity:.7">Enter your name to continue</p>
      <input id="loginName" placeholder="Your name">
      <p id="loginError" style="color:red; opacity:0.8; margin-top:10px;"></p>
      <button onclick="login()">Proceed</button>
      <div class="home-disclaimer">Â© 2025â€“2026 Sivakumar | siva80mail@gmail.com | All rights reserved</div>

    </div>
  </div>
</div>

<!-- MAIN APP -->
<div id="mainApp" class="app hidden">

  <!-- HOME -->
  <div id="home" class="screen active"></div>

  <!-- ADD -->
  <div id="add" class="screen">
    <div class="card">
      <label>User Name</label>
      <input id="username">
      <label>Currency</label>
<select id="currency" onchange="saveCurrency()">

  <!-- India -->
  <option value="â‚¹">INR â€“ Indian Rupee</option>

  <!-- United States -->
  <option value="$">USD â€“ US Dollar</option>

  <!-- Europe -->
  <option value="â‚¬">EUR â€“ Euro (France, Germany)</option>

  <!-- China -->
  <option value="Â¥">CNY â€“ Chinese Yuan</option>

  <!-- Japan -->
  <option value="Â¥">JPY â€“ Japanese Yen</option>

  <!-- United Arab Emirates -->
  <option value="Ø¯.Ø¥">AED â€“ UAE Dirham</option>

  <!-- Singapore -->
  <option value="S$">SGD â€“ Singapore Dollar</option>

  <!-- Malaysia -->
  <option value="RM">MYR â€“ Malaysian Ringgit</option>

</select>

      </select>
      <label>Amount</label>
      <input type="number" id="amount">
      <label>Category</label>
      <select id="category">
        <option value="">Select</option>
        <option>Food</option>
        <option>Travel</option>
        <option>Shopping</option>
        <option>Other</option>
      </select>
      <label>Date</label>
      <input type="date" id="date">
      <button id="addBtn" onclick="addExpense()">Add Expense</button>
    </div>
  </div>

  <!-- EXPENSES -->
  <div id="list" class="screen">
    <div class="card">
      <select id="categoryFilter" onchange="applyFilters()">
        <option value="All">All</option>
        <option>Food</option>
        <option>Travel</option>
        <option>Shopping</option>
        <option>Other</option>
      </select>
      <div class="total-caption">Total Expenses</div>
      <div class="total-box" id="total">â‚¹0</div>
      <table>
        <thead>
          <tr><th>Date</th><th>Category</th><th>Amount</th><th>Action</th></tr>
        </thead>
        <tbody id="summaryBody"></tbody>
      </table>
    </div>
  </div>

  <!-- USER SETTINGS -->
  <div id="settings" class="screen">
    <div class="card">
      <h3 id="profileName">User</h3>
      <div class="dashboard">
        <div class="stat" onclick="renderInsight()">Insights</div>
        <div class="stat" onclick="renderBudget()">Budget</div>
        <div class="stat" onclick="renderCategories()">Categories</div>
        <div class="stat" onclick="renderPreference()">Preferences</div>
      </div>
      <div class="user-output" id="userOutput">Click any tile above to view details.</div>
      <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
      <button onclick="exportCSV()">Export CSV</button>
      <button onclick="logout()">Logout</button>
    </div>
  </div>

</div>

<!-- NAV -->
<div class="bottom-nav">
  <div class="nav-item active" onclick="switchScreen('home',this)">
    <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
      <path d="M3 11l9-8 9 8"/><path d="M5 10v10h14V10"/>
    </svg>
  </div>
  <div class="nav-item" onclick="switchScreen('add',this)">
    <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
      <path d="M12 5v14M5 12h14"/>
    </svg>
  </div>
  <div class="nav-item" onclick="switchScreen('list',this)">
    <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
      <path d="M4 4h16v16H4z"/><path d="M4 10h16"/><path d="M10 4v16"/>
    </svg>
  </div>
  <div class="nav-item" onclick="switchScreen('settings',this)">
    <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
      <circle cx="12" cy="8" r="4"/>
      <path d="M4 20c2-4 14-4 16 0"/>
    </svg>
  </div>
</div>

<script>


// === ELEMENTS ===
const currency = document.getElementById("currency");
const username = document.getElementById("username");
const profileName = document.getElementById("profileName");
const amount = document.getElementById("amount");
const category = document.getElementById("category");
const date = document.getElementById("date");
const addBtn = document.getElementById("addBtn");
const total = document.getElementById("total");
const summaryBody = document.getElementById("summaryBody");
const userOutput = document.getElementById("userOutput");
const categoryFilter = document.getElementById("categoryFilter");
const navItems = document.querySelectorAll(".nav-item");
let expenses = [];
let currentUser = sessionStorage.getItem("currentUser") || null;


let editId = null;

// Initialize defaults (no user assumed yet)
// Load currency for current user, default â‚¹
currency.value = currentUser ? (localStorage.getItem(`currency_${currentUser}`) || "â‚¹") : "â‚¹";

username.value = "";
profileName.innerText = "User";


// === LOGIN ===
function login(){
  const name = loginName.value.trim();
  const loginError = document.getElementById("loginError");

  if(!name){
    loginError.innerText = "Please enter your name to continue";
    return;
  }

  loginError.innerText = "";

  // ðŸ”‘ SET CURRENT USER
  currentUser = name;
  // Load user's preferred currency
currency.value = localStorage.getItem(`currency_${currentUser}`) || "â‚¹";


  // ðŸ”‘ LOAD USER-SPECIFIC EXPENSES
  const saved = localStorage.getItem(`expenses_${currentUser}`);
  expenses = saved ? JSON.parse(saved) : [];

  // ðŸ”‘ UPDATE UI
  username.value = currentUser;
  profileName.innerText = currentUser;

  sessionStorage.setItem("loggedIn", "yes");
  sessionStorage.setItem("currentUser", currentUser);

  initApp();
}


// === LOGOUT ===
function logout(){
  sessionStorage.removeItem("loggedIn");
  location.reload();
}

// === INIT APP ===
function initApp(){
  document.getElementById("loginScreen").style.display="none";
  document.getElementById("mainApp").classList.remove("hidden");
  renderHome();
  applyFilters();
}

function isLoggedIn(){
  return sessionStorage.getItem("loggedIn") === "yes" && currentUser !== null;
}


if(sessionStorage.getItem("loggedIn") === "yes"){
  currentUser = sessionStorage.getItem("currentUser");

  if(currentUser){
    const saved = localStorage.getItem(`expenses_${currentUser}`);
    currency.value = localStorage.getItem(`currency_${currentUser}`) || "â‚¹";
    expenses = saved ? JSON.parse(saved) : [];
    profileName.innerText = currentUser;
    initApp();
  }
}


// === EXPENSE FUNCTIONS ===
function addExpense(){
  if(!amount.value || !category.value || !date.value) return;
  if(editId){
    expenses = expenses.map(e => e.id===editId ? {...e, amount: amount.value, category: category.value, date: date.value} : e);
    editId = null;
    addBtn.innerText = "Add Expense";
  } else {
    expenses.push({id: Date.now(), amount: amount.value, category: category.value, date: date.value});
  }
  localStorage.setItem(`expenses_${currentUser}`, JSON.stringify(expenses));

  amount.value = date.value = "";
  category.selectedIndex = 0;
  applyFilters();
}

// === FILTER & DISPLAY ===
function applyFilters(){
  let list = [...expenses];
  if(categoryFilter && categoryFilter.value !== "All"){
    list = list.filter(e => e.category === categoryFilter.value);
  }
  total.innerText = currency.value + list.reduce((s,e)=>s+Number(e.amount),0);
  summaryBody.innerHTML = "";
  list.forEach(e=>{
    summaryBody.innerHTML+=`
      <tr>
        <td>${e.date}</td>
        <td>${e.category}</td>
        <td>${currency.value}${e.amount}</td>
        <td>
          <button class="action-btn edit-btn" onclick="editExpense(${e.id})">Edit</button>
          <button class="action-btn delete-btn" onclick="deleteExpense(${e.id})">Del</button>
        </td>
      </tr>`;
  });
}

function editExpense(id){
  let e = expenses.find(x=>x.id===id);
  amount.value = e.amount;
  category.value = e.category;
  date.value = e.date;
  editId = id;
  addBtn.innerText = "Update Expense";
  switchScreen('add', navItems[1]);
}

function deleteExpense(id){
  expenses = expenses.filter(e=>e.id!==id);
  localStorage.setItem(`expenses_${currentUser}`, JSON.stringify(expenses));

  applyFilters();
}

function exportCSV(){
  if(!currentUser){
    alert("Please login first");
    return;
  }

  let rows = [];

  // ðŸ”¹ TOP SUMMARY
  rows.push(`User Name,${currentUser}`);
  rows.push(`Currency,${currency.value}`);

  const totalAmount = expenses.reduce((s,e)=>s+Number(e.amount),0);
  rows.push(`Total,${currency.value}${totalAmount}`);

  // Blank line
  rows.push("");

  // ðŸ”¹ TABLE HEADER
  rows.push("Date,Category,Amount");

  // ðŸ”¹ EXPENSE ROWS
  expenses.forEach(e=>{
    rows.push(`${e.date},${e.category},${e.amount}`);
  });

  let blob = new Blob(["\uFEFF" + rows.join("\n")], { type: "text/csv;charset=utf-8;" });

  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `${currentUser}_Expense_Report.csv`;
  a.click();
}


// === SCREEN SWITCHING ===
function switchScreen(id, el){
  const loginError = document.getElementById("loginError");
  
  if(sessionStorage.getItem("loggedIn") !== "yes"){
    // show inline message
    loginError.innerText = "Please login first!";
    // show login screen
    document.getElementById("loginScreen").style.display = "block";
    document.getElementById("mainApp").classList.add("hidden");
    return;
  }

  loginError.innerText = ""; // clear any previous error
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  navItems.forEach(n=>n.classList.remove("active"));
  el.classList.add("active");
  if(id==="home") renderHome();
}


// === HOME RENDER ===
function renderHome(){
  const home = document.getElementById("home");
  const displayName = username.value || localStorage.getItem("username") || 'User';
  const recent = expenses.slice(-5).reverse();
  let recentHTML = recent.length ? `
    <table style="width:100%;margin-top:12px;border-collapse:separate;border-spacing:0 8px;">
      <thead><tr><th>Date</th><th>Category</th><th>Amount</th></tr></thead>
      <tbody>
        ${recent.map(e=>`<tr>
          <td>${e.date}</td>
          <td>${e.category}</td>
          <td>${currency.value}${e.amount}</td>
        </tr>`).join('')}
      </tbody>
    </table>` : `<p style="margin-top:12px;opacity:.7;text-align:center;">No expenses yet</p>`;

  home.innerHTML = `
    <div class="card">
      <div class="home-title">Expense Tracker</div>
      <div class="home-quote">Hello, ${displayName}! ðŸ˜ŠðŸ’° Track expenses â€¢ Control spending â€¢ Live happily</div>
      ${recentHTML}
      <div class="home-disclaimer">Â© 2025â€“2026 Sivakumar | siva80mail@gmail.com | All rights reserved</div>
    </div>`;
}


// === DASHBOARD RENDER FUNCTIONS ===
function renderInsight(){userOutput.innerHTML="Total spent: <b>"+expenses.reduce((s,e)=>s+Number(e.amount),0)+"</b>";}
function renderBudget(){userOutput.innerHTML="Average per entry: <b>"+(expenses.length?(expenses.reduce((s,e)=>s+Number(e.amount),0)/expenses.length).toFixed(2):0)+"</b>";}
function renderCategories(){let c={};expenses.forEach(e=>c[e.category]=(c[e.category]||0)+Number(e.amount));userOutput.innerHTML=Object.entries(c).map(x=>`${x[0]} : ${currency.value}${x[1]}`).join("<br>");}
function renderPreference(){let c={};expenses.forEach(e=>c[e.category]=(c[e.category]||0)+1);let p=Object.entries(c).sort((a,b)=>b[1]-a[1])[0];userOutput.innerHTML=p?"Most used category: <b>"+p[0]+"</b>":"No data";}

// === MISC ===
function toggleDarkMode(){document.body.classList.toggle("dark");}
function saveCurrency(){
  if(!currentUser) return; // safety check
  localStorage.setItem(`currency_${currentUser}`, currency.value);
  applyFilters();
}


// INITIAL FILTER APPLY
applyFilters();
</script>
</body>
</html>
